<template>
    <div class="container">
        <h1 class="mt-5 text-center">U kunt hier uw gegevens aanpassen</h1>
        <div>
            <label for="email">Email:</label>
            <input v-model="user.email" id="email" placeholder="Email" />
        </div>
        <div>
            <label for="firstName">Voornaam:</label>
            <input v-model="user.firstName" id="firstName" placeholder="First Name" />
        </div>
        <div>
            <label for="lastName">Achternaam:</label>
            <input v-model="user.lastName" id="lastName" placeholder="Last Name" />
        </div>
        <div>
            <label for="phoneNumber">Telefoonnummer:</label>
            <input v-model="user.phoneNumber" id="phoneNumber" placeholder="Phone Number" />
        </div>
        <div>
            <label for="dayLimit">Dag limiet:</label>
            <input v-model="user.dayLimit" id="dayLimit" placeholder="Day Limit" />
        </div>
        <div>
            <label for="transactionLimit">Transactie limiet:</label>
            <input v-model="user.transactionLimit" id="transactionLimit" placeholder="Transaction Limit" />
        </div>
        <button @click="saveUser" class="btn-primary">Opslaan</button>
        <p id="message">{{ message }}</p>
    </div>
</template>

<script setup lang="ts">
import { reactive, onMounted, ref } from 'vue';
import { currentUserStore } from '../stores/CurrentUserStore.js';
import { useAuthenticationStore } from '../stores/AuthenticationStore';
import router from '../router';
import User from '../interfaces/User';

const authenticationStore = useAuthenticationStore();
const userStore = currentUserStore();

const message = ref('');

const user = reactive<User>({
    id: 0,
    firstName: '',
    lastName: '',
    email: '',
    phoneNumber: '',
    role: 'CUSTOMER',
    accounts: [],
    dayLimit: 0,
    transactionLimit: 0
});

onMounted(async () => {
    // Check if the user is authenticated
    if (!authenticationStore.isLoggedIn) {
        router.push('/');
    }

    await userStore.fetchUser(authenticationStore.userId);
    await userStore.getAccountsOfUser(authenticationStore.userId);

    Object.assign(user, userStore.getUser);
});

const saveUser = async () => {
    message.value = '';
    // check if both the limits are higher or equal to 0
    if (user.dayLimit !== undefined && user.dayLimit < 0 || user.transactionLimit !== undefined && user.transactionLimit < 0) {
        message.value = 'De limieten moeten hoger of gelijk zijn aan 0';
        return;
    }
    // Save the updated user data
    if (await userStore.editUser(user)) {
        message.value = 'Uw gegevens zijn succesvol aangepast';
    } else {
        message.value = 'Er is iets misgegaan';
    }
};
</script>

<style scoped></style>
